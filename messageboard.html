<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Message Board</title>

    <script src="https://www.gstatic.com/firebasejs/5.8.0/firebase.js"></script>
    <script>
        // Initialize Firebase
        let config = {
            apiKey: "AIzaSyB4DRgFC6a4Yvdsskch3cpyfO8sXaO3zuE",
            authDomain: "jstraining-advance-project.firebaseapp.com",
            databaseURL: "https://jstraining-advance-project.firebaseio.com",
            projectId: "jstraining-advance-project",
            // storageBucket: "jstraining-advance-project.appspot.com",
            // messagingSenderId: "495478327508"
        };
        firebase.initializeApp(config);
        let auth = firebase.auth();
        let provider = new firebase.auth.FacebookAuthProvider();
        provider.addScope("user_birthday");
        // 當使用者的登入狀態變化的時候，執行我們提供的函式
        let currentUser = null;
        auth.onAuthStateChanged(function (user) {
            let member = document.getElementById("member");
            let welcome = document.getElementById("welcome");
            member.style.display = "none";
            welcome.style.display = "none";
            if (user) { // User is signed in.
                member.style.display = "block";
                currentUser = user;
                console.log(user);
            } else { // User is signed out.
                console.log(user);
                currentUser = null;
                welcome.style.display = "block";
            }
        });

        function signIn() {
            auth.signInWithPopup(provider).then(function (result) {

            }).catch(function (error) {

            });
        }
        let db = firebase.database();

        function post() {
            let id = currentUser.uid;
            let name = currentUser.displayName;
            let content = document.querySelector("content").value;
            // 加入資料庫
            let ref = db.ref("/messages");
            ref.push({
                id: id,
                name: name,
                content: content,
                time: Date.now()
            }, function (error) {
                if (error) {
                    alert(error);
                } else {
                    alert("OK");
                }
            });
        }
    </script>
</head>

<body>
    <h3>Message Board</h3>
    <div id="welcome" style="display:none;">
        <button onclick="signIn();">Sign In</button>
    </div>
    <div id="member" style="display:none;">
        <textarea name="" id="content" cols="30" rows="10"></textarea>
        <button onclick="post();">Post</button>
    </div>
    <hr>
    <div id="list">Message Board</div>
</body>

</html>
